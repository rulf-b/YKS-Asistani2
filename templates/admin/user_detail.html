{% extends "layout.html" %}
{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="h3 text-primary">
                    <i class="bi bi-person-circle me-2"></i>{{ target_user.username }} - Kullanıcı Detayları
                </h1>
                <a href="/admin" class="btn btn-secondary">
                    <i class="bi bi-arrow-left me-2"></i>Geri Dön
                </a>
            </div>

            <!-- Kullanıcı Bilgileri -->
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Kullanıcı Bilgileri</h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>ID:</strong> {{ target_user.id }}</p>
                            <p><strong>Kullanıcı Adı:</strong> {{ target_user.username }}</p>
                            <p><strong>Admin:</strong> 
                                {% if target_user.is_admin %}
                                    <span class="badge bg-success">Evet</span>
                                {% else %}
                                    <span class="badge bg-secondary">Hayır</span>
                                {% endif %}
                            </p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Email Onaylı:</strong> 
                                {% if target_user.email_confirmed %}
                                    <span class="badge bg-success">Evet</span>
                                {% else %}
                                    <span class="badge bg-warning">Hayır</span>
                                {% endif %}
                            </p>
                            <p><strong>Ders Tercihi:</strong> {{ target_user.ders_tercihi or 'Belirtilmemiş' }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Hedef Bilgileri -->
            {% if hedef %}
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Hedef Bilgileri</h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>Üniversite:</strong> {{ hedef.universite }}</p>
                            <p><strong>Bölüm:</strong> {{ hedef.bolum }}</p>
                            <p><strong>Hedef Sıralama:</strong> {{ hedef.hedef_siralama or 'Belirtilmemiş' }}</p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>TYT Hedef Net:</strong> {{ hedef.hedef_tyt_net or 'Belirtilmemiş' }}</p>
                            <p><strong>AYT Hedef Net:</strong> {{ hedef.hedef_ayt_net or 'Belirtilmemiş' }}</p>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Deneme Sonuçları -->
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Deneme Sonuçları ({{ denemeler|length }})</h6>
                </div>
                <div class="card-body">
                    {% if denemeler %}
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Tarih</th>
                                    <th>Kaynak</th>
                                    <th>TYT Türkçe</th>
                                    <th>TYT Sosyal</th>
                                    <th>TYT Matematik</th>
                                    <th>TYT Fen</th>
                                    <th>AYT Matematik</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for deneme in denemeler[:10] %}
                                <tr>
                                    <td>{{ deneme.tarih.strftime('%d-%m-%Y') }}</td>
                                    <td>{{ deneme.kaynak }}</td>
                                    <td>{{ deneme.tyt_turkce_d }}/{{ deneme.tyt_turkce_d + deneme.tyt_turkce_y }}</td>
                                    <td>{{ deneme.tyt_sosyal_d }}/{{ deneme.tyt_sosyal_d + deneme.tyt_sosyal_y }}</td>
                                    <td>{{ deneme.tyt_mat_d }}/{{ deneme.tyt_mat_d + deneme.tyt_mat_y }}</td>
                                    <td>{{ deneme.tyt_fen_d }}/{{ deneme.tyt_fen_d + deneme.tyt_fen_y }}</td>
                                    <td>{{ deneme.ayt_mat_d }}/{{ deneme.ayt_mat_d + deneme.ayt_mat_y }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p class="text-muted">Henüz deneme sonucu kaydedilmemiş.</p>
                    {% endif %}
                </div>
            </div>

            <!-- Çalışma Oturumları -->
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Çalışma Oturumları ({{ calisma_oturumlari|length }})</h6>
                </div>
                <div class="card-body">
                    {% if calisma_oturumlari %}
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Tarih</th>
                                    <th>Süre (Dakika)</th>
                                    <th>Konu</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for oturum in calisma_oturumlari[:10] %}
                                <tr>
                                    <td>{{ oturum.tarih.strftime('%d-%m-%Y %H:%M') }}</td>
                                    <td>{{ oturum.calisma_suresi_dakika }}</td>
                                    <td>{{ oturum.konu_adi or 'Belirtilmemiş' }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p class="text-muted">Henüz çalışma oturumu kaydedilmemiş.</p>
                    {% endif %}
                </div>
            </div>

            <!-- Quiz Sonuçları -->
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Quiz Sonuçları ({{ quiz_sonuclari|length }})</h6>
                </div>
                <div class="card-body">
                    {% if quiz_sonuclari %}
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Tarih</th>
                                    <th>Konu</th>
                                    <th>Doğru</th>
                                    <th>Yanlış</th>
                                    <th>Boş</th>
                                    <th>Başarı %</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for quiz in quiz_sonuclari[:10] %}
                                <tr>
                                    <td>{{ quiz.tarih.strftime('%d-%m-%Y') }}</td>
                                    <td>{{ quiz.konu }}</td>
                                    <td>{{ quiz.dogru_sayisi }}</td>
                                    <td>{{ quiz.yanlis_sayisi }}</td>
                                    <td>{{ quiz.bos_sayisi }}</td>
                                    <td>
                                        {% set toplam = quiz.dogru_sayisi + quiz.yanlis_sayisi + quiz.bos_sayisi %}
                                        {% if toplam > 0 %}
                                            {{ "%.1f"|format(quiz.dogru_sayisi / toplam * 100) }}%
                                        {% else %}
                                            0%
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p class="text-muted">Henüz quiz sonucu kaydedilmemiş.</p>
                    {% endif %}
                </div>
            </div>

            <!-- Soru Analizleri -->
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Soru Analizleri ({{ soru_analizleri|length }})</h6>
                </div>
                <div class="card-body">
                    {% if soru_analizleri %}
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Tarih</th>
                                    <th>Konu</th>
                                    <th>Zorluk</th>
                                    <th>Hata Türü</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for analiz in soru_analizleri[:10] %}
                                <tr>
                                    <td>{{ analiz.tarih.strftime('%d-%m-%Y') }}</td>
                                    <td>{{ analiz.konu or 'Belirtilmemiş' }}</td>
                                    <td>{{ analiz.zorluk_derecesi or 'Belirtilmemiş' }}</td>
                                    <td>{{ analiz.hata_turu or 'Belirtilmemiş' }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p class="text-muted">Henüz soru analizi yapılmamış.</p>
                    {% endif %}
                </div>
            </div>

            <!-- Haftalık Planlar -->
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Haftalık Planlar ({{ haftalik_planlar|length }})</h6>
                </div>
                <div class="card-body">
                    {% if haftalik_planlar %}
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Gün</th>
                                    <th>Konu</th>
                                    <th>Süre (Dakika)</th>
                                    <th>Notlar</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for plan in haftalik_planlar[:10] %}
                                <tr>
                                    <td>{{ plan.gun }}</td>
                                    <td>{{ plan.konu }}</td>
                                    <td>{{ plan.sure }}</td>
                                    <td>{{ plan.notlar or 'Not yok' }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p class="text-muted">Henüz haftalık plan oluşturulmamış.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}